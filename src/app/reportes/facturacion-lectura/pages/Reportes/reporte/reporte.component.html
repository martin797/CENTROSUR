<p-toast position="top-right"></p-toast>
<div>
    <div class="contaner-lg">
        <div class="row justify-content-md-center">
            <p class="font-monospace">Reportes de {{tipo_reporte}}</p>
        </div>
    </div>
    <div class="container-lg">
        <div class="row row-subtitle">
            <div class="col-md-5">
                <p class="font-monospace2">Informe</p>
            </div>
            <ng-container *ngIf="doc_actual.nuevo">
                <div class="col etiq_nuevo">
                    <p class="font-monospace3">Nuevo Filtro</p>
                </div>
            </ng-container>
        </div>
        <div class="row">
            <div class="col-sm-6 my_card my_color">
                <div class="row">
                    <h1 class="text_card">Documento:</h1>
                    <h1 class="text_card_value">{{doc_actual.nombre}}</h1>
                </div>
                <div class="row">
                    <div class="col">
                        <h1 class="text_card">Numero de registros:</h1>
                        <h1 class="text_card_value">{{doc_actual.filas}}</h1>
                    </div>
                    <div class="col">
                        <h1 class="text_card">Nombre del Filtro:</h1>
                        <h1 class="text_card_value">{{filtro_actual.nombre_filtro}}</h1>
                    </div>
                </div>
            </div>
            <div class="col-sm-2">
                <p class="error"> Alertas:</p>
            </div>
            <div class="col-sm-4">
                <circle-progress [percent]=numero [title]=cantidad [maxPercent]="100" [radius]="80" [responsive]=false
                    [outerStrokeWidth]="10" [innerStrokeWidth]="2" [outerStrokeColor]="'#78C000'"
                    [innerStrokeColor]="'#C7E596'" [animation]="true" [animationDuration]="300" [titleFontSize]="'50'"
                    [titleFontWeight]="'700'" [titleColor]="'#ff6347'" [units]="'/'" [unitsFontSize]="'50'"
                    [unitsColor]="'#ffffff'" [subtitle]="total" [subtitleFontSize]="'30'" [subtitleColor]="'#ffffff'">
                </circle-progress>
            </div>
        </div>
        <hr>
        <div class="row cont_botones">
            <div class="col">
                <button class="btn btn-person" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapseNombres">
                    <i class="bi bi-card-checklist"></i> Editar Nombre </button>
            </div>
            <div class="col">
                <button class="btn btn-dark" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFiltros">
                    <i class="bi bi-card-checklist"></i> Editar Filtro </button>
            </div>
            <div class="col">
                <button (click)="guardarFiltro()" class="btn btn-success" type="button"><i class="fas fa-save"></i>
                    Guardar Cambios </button>
            </div>
            <div class="col">
                <button (click)="descargar()" class="btn btn-warning" type="button"><i
                        class="bi bi-arrow-down-circle-fill"></i> Descargar</button>
            </div>
        </div>
        <hr>
        <div class="collapse" id="collapseNombres">
            <div class="card card-body">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="col">
                                <label class="text_etiqueta">Nombre del documento:</label>
                                <input class="form-control form-control-lg text_value" type="text"
                                    aria-label=".form-control-lg example" (keyup)="ingresoTittle_doc($event)"
                                    value="{{nombre_doc}}">
                            </div>
                            <div class="col">
                                <label class="text_etiqueta">Nombre del filtro:</label>
                                <input class="form-control form-control-lg text_value" type="text"
                                    aria-label=".form-control-lg example" (keyup)="ingresoTittle_filtro($event)"
                                    value="{{nombre_filtro}}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="collapse" id="collapseFiltros">
            <div class="card card-body">
                <div class="container text-center">
                    <div class="row">
                        <label class="text_filtros text-center">Filtrar documento</label>
                        <br>
                        <br>
                        <div class="col" *ngFor="let colum of columns_doc">
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="dropdown">
                                        <button class="btn btn-primary" type="button" data-bs-toggle="collapse"
                                            [attr.data-bs-target]="'#select'+colum" aria-expanded="false"
                                            aria-controls="collapseFiltros">
                                            {{colum}}
                                            <i class="bi bi-caret-down-square"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="col-sm-6" *ngIf="tieneConfig(colum); else noTieneConfig">
                                    <button type="button" class="btn btn-filter-active m-2" data-bs-toggle="modal"
                                        [attr.data-bs-target]="'#'+colum">
                                        <i class="fas fa-filter"></i>
                                    </button>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-danger dropdown-toggle"
                                            data-bs-toggle="dropdown">
                                            <img src="./assets/iconos/deleteFilter.png" />
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li><a class="btn dropdown-item" (click)="deleteFiltro(colum)">Eliminar
                                                    Filtro</a></li>
                                        </ul>
                                    </div>
                                </div>
                                <ng-template #noTieneConfig>
                                    <div class="col-sm-6">
                                        <button type="button" class="btn btn-secondary m-2" data-bs-toggle="modal"
                                            [attr.data-bs-target]="'#'+colum">
                                            <i class="fas fa-filter"></i>
                                        </button>
                                        <div class="btn-group">
                                            <button type="button" class="btn btn-secondary dropdown-toggle"
                                                data-bs-toggle="dropdown" disabled>
                                                <img src="./assets/iconos/deleteFilter.png" />
                                            </button>
                                            <ul class="dropdown-menu">
                                                <li><a class="btn dropdown-item" (click)="deleteFiltro(colum)">Eliminar
                                                        Filtro</a></li>
                                            </ul>
                                        </div>
                                    </div>

                                </ng-template>
                            </div>
                            <div class="row">
                                <div class="collapse" id="select{{colum}}">
                                    <div class="card card-body">
                                        Buscar: ----------
                                        <div class="list-group my_scroll">
                                            <label class="list-group-item list-group-item-action">
                                                <input class="form-check-input me-1" type="checkbox" value="">
                                                Seleccionar todo
                                            </label>
                                            <label class="list-group-item list-group-item-action"
                                                *ngFor="let valor of getRowsUnique(colum)">
                                                <input class="form-check-input me-1" type="checkbox" value="">
                                                {{valor}}
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--Vista de la ventana emergente-->
                            <app-modal [doc_actual]="doc_actual" [filtro_actual]="filtro_actual" [colum]="colum"
                                [rowsUnique]="getRowsUnique(colum)" [columns_doc]="columns_doc"
                                [first_element]="dataDocument[0]" (enviarConfiguracion)="recogerFiltros($event)">
                            </app-modal>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluit">
            <table class="table">
                <thead class="table-dark">
                    <tr>
                        <th *ngFor="let colum of columns_doc">
                            {{colum}}
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let row of rows_doc">
                        <td *ngFor="let val of row">
                            {{val}}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <br>
        <br>
    </div>
</div>